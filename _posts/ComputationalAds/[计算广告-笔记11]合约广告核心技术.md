---
title: 计算广告-笔记11：合约广告核心技术
tags:
  - 核心技术
comments: true
categories:
  - 计算广告
mathjax: false
abbrlink: 5df7f5ff
date: 2020-10-03 10:09:31
top: 0
---

## 广告位合约(CPT)

### 一般采用广告排期系统来管理和执行

- 将广告素材按预先确定的排期插入媒体页面，并通过内容分发系网络CDN)加速访问
- 广告未能返回时，需设定防天窗广告补位

## 展示量合约(CPM)

### 对应的广告系统称为担保式投送(GD)系统

- 系统架构

	- 在线投放引擎接收用户触发的广告请求
	- 根据用户标签和上下文标签找到可以匹配的广告合约
	- 在线分配模块决定本次展示投放那个广告（最重要）
	- 决策完成后，将展示和点击日志送入数据高速公路。

		- 一部分进入离线分布式平台，通过日志整理确定在线分配算法的参数，再将分配方案送给在线投放引擎使用。
		- 另一部分日志送到流式计算平台，在反作弊和计价基础上，再对索引进行快速调整。

### 核心技术

- 流量预测

	- 给定一组受众标签组合，估算将来某个时间段内符合该受众标签组合的广告展示量
	- 主要方法包括基于历史统计来拟合未来流量和时间序列分析方法

		- 基于反向索引的流量预测方法

- 频次控制

	- 一般来说，随着某个用户看到同一个创意频次的提升，点击率会呈下降趋势，因此控制某个广告曝光给同一用户的次数，可以提升广告主的ROI
	- 有客户端和服务端两种解决方案

		- 客户端：将频次记录在cookie中

			- 优点：简单易行，服务成本低
			- 缺点：扩展性差，若跟踪多个广告频次时，cookie变重，影响广告响应时间。
			- 移动端利用SDK控制方案非常好

		- 服务端：在后台设置一个专门用来频次记录和更新的缓存

			- 缓存特点

				- 高并发读
				- 高并发写

			- 轻量级缓存方案

				- 频次存储的规模是有上限的，比如在某个周期内统计。
				- 当用(a,u)的组合生成缓存中对应的key时，可以接受不处理冲突

- 在线分配

	- 两个主要挑战

		- 在量的约束下优化效果
		- 实时对每一次展示做出决策

	- 一般将问题转化为一个二部图匹配的问题

		- 供给节点：广告库存
		- 需求节点：广告合约量
		- 如果某个供给节点的受众标签能够满足某个需求节点的要求，就在两个节点间建立一条连接边

	- 可将问题表示为带约束的优化问题

	  - 需求约束：分配给某广告合约a的收益要至少等于其约定的量d

	    ![](https://cdn.jsdelivr.net/gh/notlate-cn/imgs/blogs/image-20210203214947007.png)
	
	    - qia：供给节点i连接到需求节点a的单位流量惩罚
    - si：供给节点i的总供给量
	    - xia：si分配给合约a的比例
	
  - 供给约束：每个供给节点被分配出去的量小于等于总流量
	
    ![](https://cdn.jsdelivr.net/gh/notlate-cn/imgs/blogs/image-20210203214958074.png)
	
  - 引入供给约束和需求约束后的在线分配优化问题框架
	
	    ![](https://cdn.jsdelivr.net/gh/notlate-cn/imgs/blogs/image-20210203215006126.png)

	- 问题举例

	  - GD问题(按CPM售卖)
	
	  	- 不考虑合约未完成惩罚：目标函数是常数，此时优化目标主要在于更好的满足所有的合约，而不是优化eCPM
	  	- 考虑合约未完成惩罚：目标函数不是常数，可以增加一项惩罚项约束即可。
	
  - AdWords问题(有预算约束的出价问题，CPC)
	
	  	- 目标函数和需求约束增加参数qia
	  	
	  	  ![](https://cdn.jsdelivr.net/gh/notlate-cn/imgs/blogs/image-20210203215021460.png)
  	
	  	- 优化目标：整个市场收入最大化

	  	- 供给约束：与GD一致，总分配比例≤1
  	
	  	- 需求约束：每个广告主的花费总和应该小于该广告主的预算
	  	
  	- 简单理解
	  	
	  		- 把供给节点i理解为搜索广告中的1个关键词
  		- qia：广告a对关键词i的出价（关键词i的一次点击分配给广告a的期望收益）
	  		- si：关键词i的总点击量
  		- xia：关键词i分配给广告a的流量比例
	
- 极限性能
	
		- 研究指标：某在线分配策略的有效性

			- 最优解：如果能够完全确定所有的流量分布，可以根据全局信息求得分配的最优解
		- e-competitive：在线分配策略最差情况下能够达到最优解目标函数的e倍，称分配方案是e-competitive的
	
		- 带约束优化求解：
		- 最好的极限性能上限：1-1/e
	
- 实用优化算法
	
		- 分配方案要求
	
			- 紧凑性：离线分配的复杂度和线上响应时间
			- 无状态：投放策略与前面的投放历史无关
	
		- 常见优化方法
	
			- 直接求解的原始分配方案：利用历史流量拟合未来流量，把在线分配转化成离线问题
			- 基于对偶算法的紧凑分配方案
			- 综合分配方案SHALE
			- 启发式分配方案HWM（最常用）
	
				- 根据历史流量确定每个广告合约资源的紧缺程度，得到分配优先级
				- 根据优先级确定各个广告合约的分配比例

